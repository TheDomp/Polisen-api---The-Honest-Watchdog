<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Honest Watchdog ‚Äî Swedish Police Incident QA</title>
    <meta name="description"
        content="Data-driven dashboard for Swedish Police Incidents with real-time integrity scoring and QA validation.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css?v=1.1">
</head>

<body>
    <div class="bg-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    <path d="M9 12l2 2 4-4" />
                </svg>
            </div>
            <h1>The Honest Watchdog</h1>
        </div>
        <nav class="nav-tabs">
            <a href="#dashboard" class="nav-tab active" data-page="dashboard">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7" />
                    <rect x="14" y="3" width="7" height="7" />
                    <rect x="3" y="14" width="7" height="7" />
                    <rect x="14" y="14" width="7" height="7" />
                </svg>
                √ñversikt
            </a>
            <a href="#karta" class="nav-tab" data-page="karta">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" />
                    <circle cx="12" cy="10" r="3" />
                </svg>
                Karta
            </a>
            <a href="#statistik" class="nav-tab" data-page="statistik">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 20V10" />
                    <path d="M12 20V4" />
                    <path d="M6 20v-6" />
                </svg>
                Statistik
            </a>
            <a href="#incidenter" class="nav-tab" data-page="incidenter">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                    <path d="M14 2v6h6" />
                </svg>
                Incidenter
            </a>
            <a href="#qa-lab" class="nav-tab nav-tab-qa" data-page="qa-lab">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 3h6v2H9zM12 5v5" />
                    <path d="M5 11h14l-1.5 9H6.5L5 11z" />
                    <circle cx="8.5" cy="15" r="1.5" />
                    <circle cx="15.5" cy="15" r="1.5" />
                </svg>
                QA Lab
            </a>
        </nav>
        <div class="header-right">
            <div class="qa-live-badge" id="qaLiveBadge">
                <span class="pulse-dot"></span>
                QA LIVE
            </div>
        </div>
    </header>

    <main class="main-content" id="mainContent">

        <!-- PAGE: √ñversikt -->
        <div class="page" id="page-dashboard">
            <section class="stats-comparison">
                <div class="glass-card stat-card total-card">
                    <div class="stat-label">Totala Incidenter <span id="timeRangeLabel"
                            style="font-size:0.75rem; opacity:0.6; font-weight:normal; margin-left:8px;"></span></div>
                    <div class="stat-number" id="totalCount">‚Äî</div>
                    <div class="stat-sublabel">Polisen.se API</div>
                    <div class="stat-bar-track">
                        <div class="stat-bar stat-bar-total" id="totalBar"></div>
                    </div>
                </div>
                <div class="vs-divider"><span>VS</span></div>
                <div class="glass-card stat-card verified-card">
                    <div class="stat-label">Verifierade Incidenter</div>
                    <div class="stat-number verified-number" id="verifiedCount">‚Äî</div>
                    <div class="stat-sublabel">Integrity Score ‚â• 50</div>
                    <div class="stat-bar-track">
                        <div class="stat-bar stat-bar-verified" id="verifiedBar"></div>
                    </div>
                </div>
            </section>

            <section class="glass-card score-distribution-card">
                <h2>Integritetspo√§ng</h2>
                <div class="score-bars">
                    <div class="score-range"><span class="range-label">0‚Äì24</span>
                        <div class="range-bar-track">
                            <div class="range-bar range-critical" id="bar0"></div>
                        </div><span class="range-count" id="count0">0</span>
                    </div>
                    <div class="score-range"><span class="range-label">25‚Äì49</span>
                        <div class="range-bar-track">
                            <div class="range-bar range-low" id="bar25"></div>
                        </div><span class="range-count" id="count25">0</span>
                    </div>
                    <div class="score-range"><span class="range-label">50‚Äì74</span>
                        <div class="range-bar-track">
                            <div class="range-bar range-medium" id="bar50"></div>
                        </div><span class="range-count" id="count50">0</span>
                    </div>
                    <div class="score-range"><span class="range-label">75‚Äì100</span>
                        <div class="range-bar-track">
                            <div class="range-bar range-high" id="bar75"></div>
                        </div><span class="range-count" id="count75">0</span>
                    </div>
                </div>
            </section>

            <section class="glass-card mini-map-card" onclick="navigateTo('karta')">
                <div class="panel-header">
                    <h2>üó∫Ô∏è Incidentkarta</h2>
                    <span class="view-more">Visa fullsk√§rm ‚Üí</span>
                </div>
                <div id="miniMap"></div>
            </section>
        </div>

        <!-- PAGE: Karta -->
        <div class="page hidden" id="page-karta">
            <section class="glass-card map-section-full">
                <div class="panel-header">
                    <h2>üó∫Ô∏è Incidentkarta ‚Äî Sverige</h2>
                    <div class="filter-pills">
                        <button class="pill active" onclick="setMapFilter('all', this)">Alla</button>
                        <button class="pill" onclick="setMapFilter('verified', this)">Verifierade</button>
                        <button class="pill" onclick="setMapFilter('flagged', this)">Flaggade</button>
                    </div>
                </div>
                <div id="fullMap"></div>
                <div class="map-legend">
                    <span class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span>Trafik</span>
                    <span class="legend-item"><span class="legend-dot"
                            style="background:#ef4444"></span>Misshandel</span>
                    <span class="legend-item"><span class="legend-dot" style="background:#8b5cf6"></span>St√∂ld</span>
                    <span class="legend-item"><span class="legend-dot" style="background:#f59e0b"></span>Brand</span>
                    <span class="legend-item"><span class="legend-dot"
                            style="background:#f97316"></span>Rattfylleri</span>
                    <span class="legend-item"><span class="legend-dot" style="background:#06b6d4"></span>Kontroll</span>
                    <span class="legend-item"><span class="legend-dot" style="background:#6b7280"></span>√ñvrigt</span>
                </div>
            </section>
        </div>

        <!-- PAGE: Statistik -->
        <div class="page hidden" id="page-statistik">
            <section class="stats-grid">
                <div class="glass-card stats-panel crime-panel">
                    <div class="panel-header">
                        <h2>üìä Brottstyper</h2>
                    </div>
                    <div class="crime-type-list" id="crimeTypeList"></div>
                </div>
                <div class="glass-card stats-panel time-panel">
                    <div class="panel-header">
                        <h2>‚è∞ Tidsm√∂nster (24h) <span id="timeChartRangeLabel"
                                style="font-size:0.9rem; font-weight:normal; opacity:0.7">(Senaste
                                500 h√§ndelserna)</span></h2>
                    </div>
                    <div class="time-chart" id="timeChart"></div>
                    <p class="chart-note" id="timeChartNote"></p>
                    <div
                        style="font-size: 0.75rem; color: var(--text-muted); text-align: center; margin-top: 10px; padding: 0 10px;">
                        <em>üí° Graferna fylls p√• allt eftersom databasen samlar historik upp till 7 dagar. Tomma
                            timmar/dagar inneb√§r antingen inga h√§ndelser eller att databasen just startats.</em>
                    </div>
                </div>
            </section>

            <section class="stats-grid" style="margin-top: 20px;">
                <div class="glass-card stats-panel time-panel">
                    <div class="panel-header">
                        <h2>üìÖ Incidenter per Veckodag <span
                                style="font-size:0.9rem; font-weight:normal; opacity:0.7"></span></h2>
                    </div>
                    <div class="time-chart" id="dayChart"></div>
                </div>
                <div class="glass-card stats-panel region-panel">
                    <div class="panel-header" title="Visar vilka l√§n som har allra h√∂gst snittpo√§ng i Honesty Engine">
                        <h2>üõ°Ô∏è Kvalitetsligan (B√§st rapportering) <span
                                style="font-size:0.9rem; font-weight:normal; opacity:0.7"></span></h2>
                    </div>
                    <div class="region-list" id="integrityRegionList" style="max-height: 250px;"></div>
                </div>
            </section>

            <section class="glass-card stats-panel region-full-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <h2>üèôÔ∏è Incidenter per L√§n <span style="font-size:0.9rem; font-weight:normal; opacity:0.7">(Senaste
                            500 h√§ndelserna)</span></h2>
                </div>
                <div class="region-list" id="regionList"></div>
            </section>
        </div>

        <!-- PAGE: Incidenter -->
        <div class="page hidden" id="page-incidenter">
            <section class="glass-card incidents-full-panel">
                <div class="panel-header">
                    <h2>Alla Incidenter<span id="incidentRegionSubHeader"
                            style="opacity:0.8; font-weight:normal;"></span></h2>
                    <div class="filter-pills">
                        <button class="pill active" data-filter="all"
                            onclick="filterIncidents('all', this)">Alla</button>
                        <button class="pill" data-filter="verified"
                            onclick="filterIncidents('verified', this)">Verifierade</button>
                        <button class="pill" data-filter="flagged"
                            onclick="filterIncidents('flagged', this)">Flaggade</button>
                    </div>
                </div>
                <div class="incident-list" id="incidentList">
                    <div class="loading-skeleton">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- PAGE: QA Lab -->
        <div class="page hidden" id="page-qa-lab">
            <!-- Hero Section -->
            <section class="glass-card qa-hero">
                <div class="qa-hero-badge">üõ°Ô∏è AI Watchdog Simulator</div>
                <h2>Kan du se felen innan AI:n fixar dem?</h2>
                <p>Nedan kan du <strong>simulera vanliga datafel</strong> som smyger sig in i polisens √∂ppna data.
                    F√∂rst visas den <em>trasiga</em> incidenten ‚Äî med tydliga markeringar som visar vad som √§r fel.
                    Sedan aktiverar du <strong>Watchdog-AI</strong> som r√§ttar felen automatiskt, i realtid.</p>
            </section>

            <!-- Scenario Selector -->
            <section class="qa-section">
                <h3 class="qa-section-title">üí• V√§lj ett scenario</h3>
                <p class="qa-section-desc">Varje scenario representerar ett verkligt datafel som kan dyka upp i polisens
                    system. Klicka f√∂r att se felet ‚Äî och sedan l√•ta AI:n laga det.</p>
                <div class="chaos-scenarios" id="chaosScenarios"></div>
            </section>

            <!-- Incident Viewer -->
            <section class="qa-section" id="chaosViewerSection" style="display:none;">
                <div class="chaos-viewer glass-card" id="chaosViewer">
                    <!-- Phase indicator -->
                    <div class="chaos-phase" id="chaosPhase">
                        <span class="phase-badge phase-broken" id="phaseBadge">‚ö†Ô∏è Trasig data inmatad</span>
                    </div>

                    <!-- Incident card -->
                    <div class="chaos-incident" id="chaosIncident">
                        <div class="chaos-field" id="chaosFieldType">
                            <span class="chaos-label">Typ</span>
                            <span class="chaos-value" id="chaosType"></span>
                        </div>
                        <div class="chaos-field" id="chaosFieldLocation">
                            <span class="chaos-label">Plats</span>
                            <span class="chaos-value" id="chaosLocation"></span>
                        </div>
                        <div class="chaos-field" id="chaosFieldGps">
                            <span class="chaos-label">GPS</span>
                            <span class="chaos-value" id="chaosGps"></span>
                        </div>
                        <div class="chaos-field" id="chaosFieldDatetime">
                            <span class="chaos-label">Tidpunkt</span>
                            <span class="chaos-value" id="chaosDatetime"></span>
                        </div>
                        <div class="chaos-field chaos-field-wide" id="chaosFieldSummary">
                            <span class="chaos-label">Sammanfattning</span>
                            <span class="chaos-value" id="chaosSummary"></span>
                        </div>
                    </div>

                    <!-- Error explanations (shown in broken state) -->
                    <div class="chaos-errors" id="chaosErrors"></div>

                    <!-- Fix button -->
                    <div class="chaos-actions" id="chaosActions">
                        <button class="chaos-fix-btn" id="chaosFixBtn" onclick="chaosRunFix()">
                            <span class="fix-icon">ü™Ñ</span>
                            <div class="fix-text">
                                <strong>Aktivera Watchdog-AI</strong>
                                <span>L√•t AI:n hitta och laga alla fel</span>
                            </div>
                        </button>
                    </div>

                    <!-- Fix explanation (shown after fix) -->
                    <div class="chaos-fix-result" id="chaosFixResult" style="display:none;">
                        <div class="fix-result-header">
                            <span class="fix-result-icon">‚úÖ</span>
                            <strong>Watchdog-AI har lagat felen!</strong>
                        </div>
                        <p id="chaosFixExplanation"></p>
                    </div>
                </div>
            </section>

            <!-- QA Live Feed -->
            <section class="glass-card qa-feed-panel">
                <div class="panel-header">
                    <h2>üì° QA Live Feed</h2>
                    <span class="feed-count" id="feedCount">0 loggar</span>
                </div>
                <div class="qa-feed" id="qaFeed"></div>
            </section>
        </div>
    </main>

    <!-- Honesty Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
        <div class="modal glass-card" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">‚úï</button>
            <div class="modal-header">
                <div class="modal-score-ring">
                    <svg viewBox="0 0 120 120">
                        <circle cx="60" cy="60" r="52" class="ring-bg" />
                        <circle cx="60" cy="60" r="52" class="ring-progress" id="modalRingProgress" />
                    </svg>
                    <span class="ring-text" id="modalScoreText">0</span>
                </div>
                <div class="modal-title-area">
                    <h3 id="modalTitle">Incident</h3>
                    <p class="modal-type" id="modalType">Typ</p>
                    <p class="modal-location" id="modalLocation">Plats</p>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4>Beskrivning</h4>
                    <p id="modalDescription">‚Äî</p>
                </div>
                <div class="modal-section">
                    <h4>Integritetsanalys</h4>
                    <div class="integrity-breakdown" id="integrityBreakdown"></div>
                </div>
                <div class="modal-section" id="flagReasonsSection" style="display:none">
                    <h4>‚ö†Ô∏è Flaggade problem</h4>
                    <ul class="flag-reasons" id="flagReasonsList"></ul>
                </div>
                <a class="modal-link" id="modalLink" href="#" target="_blank" rel="noopener">
                    L√§s mer p√• Polisen.se ‚Üí
                </a>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="sandbox-toast" id="sandboxToast">
        <div class="toast-icon" id="toastIcon">üß™</div>
        <div class="toast-content">
            <div class="toast-title" id="toastTitle">Testdata injicerad</div>
            <div class="toast-detail" id="toastDetail">Score: 30/100</div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="app.js?v=1.1"></script>
</body>

</html>